---
title: "Math 660"
output:
  pdf_document: default
  html_document: default
date: "September 25, 2022"
theme: cerulean
---

<!-- For more info on RMarkdown see http://rmarkdown.rstudio.com/ -->

## Name: Emiliana Geronimo
```{r, echo=FALSE}
citibike <- read.csv("201611-citibike-tripdata.csv", header=T)
citibikerides <- read.csv("2016Q4-RidershipMembership.csv", header=T)
```
### 1. There are 1,196,942 observations of bike rides recorded in the data set. 
```{r}
nrow(citibike)
```
### 2. The dataset shows that 22.445% are female riders and 69.173% are male riders (specifically 827,966 males and 268,652 females). This is interesting because this shows that men are using Citibike to bike more than females, even if the unknown portion is fully female. This obeservation can give more information on Citibike's customer audience.  

```{r, echo=FALSE, fig.align='center'}
citibike.table <- table(citibike$Gender)
citibike.percent<-100*citibike.table/sum(citibike.table)
temp.name <- paste(format(citibike.percent, digits=4, trim=T), "%", sep="")
citibike.names <- paste(names(citibike.table), temp.name)
pie(citibike.table, labels=citibike.names, main="Citibike Gender (1=male,2=female,0=unknown)")
table(citibike$Gender)
```

### 3. The plot shows a graph that is skewed left which means that the bulk of the data is around the right end of the birth years. The median(1980) and mean(1978) are relatively close together, but the data is heavily skewed which may be due to the outliers. The minimum birth year is 1885 and the data has other recorded birth years in the 1800s and early 1900s. This is unreasonible considering they would have been in their 100-120s when the Citibike data was recorded (2016). This could be due to typos or false, unvalidated input. There is also many NA's (96,366) in this category which is a relative amount of data missing.

```{r, echo=FALSE, fig.align='center'}
plot(table(citibike$Birth.Year), main="Birth Year Frequency", xlab="Birth Year", ylab = "Frequency")
summary(citibike$Birth.Year)
```

### 4. In the trip rides database, 91.773% of Citibike Users are Subscribers while 7.180% are Customers (non-subscribers). This proportion compares the frequency of the rides with the customer’s user types.To continue, the ridership database was analyzed to investigate the proportion of customers that were non-annual subscribers by using three days (first day, middle day, and last day) of the dataset. The middle day(1.03%) was slightly lower than the first day (1.06%) of non-annual subscribers. However, the last day was drastically lower in non-annual subscribers(0.01%). With that analysis, we can conclude that the amount of non-annual subscribers are decreasing along with the amount of riders they are taking.  It is probably due to the fact that non-annual subscribers are probably visitors or people who do not use bikes as their primary source of transportation. Another probable reason for the decline is that Citibike may be attracting non-annual subscribers to subscribe rather than buy passes.

```{r, echo=FALSE, fig.align='center'}
citibike.table2 <- table(citibike$User.Type)
citibike.percent<-100*citibike.table2/sum(citibike.table2)
temp.name <- paste(format(citibike.percent, digits=4, trim=T), "%", sep="")
citibike.names <- paste(names(citibike.table2), temp.name)
pie(citibike.table2, labels=citibike.names, main = "Customers Who Ride")
```

```{r, echo=FALSE, results='hide'}
day1 <- sum(citibikerides$X24.Hour.Passes.Purchased.Today[1],citibikerides$X3.Day.Passes.Purchased.Today[1])
day1proportion <- paste(format(day1/sum(day1,citibikerides$All.Time.Total.Annual.Members[1])*100),"%", sep="")
day1proportion

day2 <- sum(citibikerides$X24.Hour.Passes.Purchased.Today[46],citibikerides$X3.Day.Passes.Purchased.Today[46], na.rm = FALSE)
day2
day2proportion <- paste(format(day1/sum(day1,citibikerides$All.Time.Total.Annual.Members[46])*100),"%", sep="")
day2proportion

day3 <- sum(citibikerides$X24.Hour.Passes.Purchased.Today[-1],citibikerides$X3.Day.Passes.Purchased.Today[-1], na.rm = FALSE)
day3
day3proportion <- paste(format(day1/sum(day1,citibikerides$All.Time.Total.Annual.Members[-1])*100),"%", sep="")
day3proportion

difftimeproportion <- c(day1proportion,day2proportion,day3proportion)
```

```{r}
difftimeproportion
```
### 5. The time plot shows that the Customer use of both the 24 Hour Passes and 3 Day Passes have declined over time.The 24 hour Passes declined more drastically compared to the 3 Day Passes.  More 24 Hour Passes were purchased compared to the 3 Day passes which may have been due to customers, such as tourists, who needed a quick bike ride. The time of year may also have had an effect on the customers' decline in purchases because the last day recorded is in December of 2016. Colder weather could be a lurking variable that may drive customers to stay in or take a warmer form of transportation. 
```{r, echo=FALSE, fig.align='center'}
plot(citibikerides$X24.Hour.Passes.Purchased.Today, main = "Customer Purchases", xlab = "Days", ylab = "Number of Passes Purchased", type = 'l')
lines(citibikerides$X3.Day.Passes.Purchased.Today, col = 'blue')
legend("topright", legend=c("24 Hour Passes", "3 Day Passes"), fill = c("black","blue"))
```

### 6. The summary statistics of the Trip Duration show that there are some unusual values, specifically the max with 4319753 seconds. This would mean that a customer has biked for 50 days (about 2 months) straight for one ride session. Reasonable explanations may be that the bike malfunctioned and couldn't end the session or that the bike was left and the session didn’t end. To make a histogram of the Trip Duration, the outliers were removed because it made the histogram heavily skewed since the outliers were influential points. This was done by using the 3rd and 1st quartiles to find the whiskers of the data set to know the limits of what trip duration was considered an outlier. After, the histogram was plotted with a cap of 1989(higher limit), which excludes all outliers. This makes sense because 1989 seconds(33.15 minutes) is much more reasonable than the max of the Trip Duration data set. The plot shows a right skewed histogram meaning the frequency of rides were greater with a shorter trip duration.   
```{r, echo=FALSE, fig.align='center'}
summary(citibike$Trip.Duration)
lowerlimit <- 369 - 1.5*IQR(citibike$Trip.Duration)
paste("Lower limit is ", lowerlimit)
higherlimit <- 1017 + 1.5*IQR(citibike$Trip.Duration)
paste("Higher limit is ", higherlimit)
betterduration <- citibike$Trip.Duration[citibike$Trip.Duration<=1989]
hist(betterduration, main = "Histogram of Trip Duration", xlab = "Seconds")
```
### 7. According to the plot, there is a decline in the amount of trips per day over a period of time.  The summary statistics show that the mean and medium are closer to the beginning of the plot; depicting that earlier in the recording the data, there were a higher number of trips made by the customers. A lurking variable for this occurrence could be the weather since the data was taken towards the middle of the winter. Biking in the winter, especially with snow, is dangerous and may not happen as often compared to warmer weather. 
```{r, echo=FALSE, fig.align='center'}
plot(citibikerides$Trips.today, main = "Trips Per Day", xlab="Days", ylab = "Number of Trips", type = "l")
summary(citibikerides$Trips.today)

```
### 8. In the histogram of daily number of trips for the 4th quarter of 2016, the distribution shows a slight decline where shorter amounts of trips daily were more frequent. However, this conclusion is based on looking at the data as a whole. The second histogram magnifies into October’s daily number of trips taken. In this histogram, the distribution is different and shows that more trips in a day was a more frequent occurrence. With this, one can conclude that November’s and/or December’s daily number of trips influenced the overall data. 
```{r, echo = FALSE}
hist(citibikerides$Trips.today, main = "Daily Number of Trips", nclass = 10, xlab = "Trips", xlim = c(20000,70000))
octdur <- citibikerides$Trips.today[1:31]
hist(octdur, nclass=10, main = "October's Daily Number of Trips", xlab = "Trips", xlim = c(20000,70000))
```

###9a. There are some variables that have unusual data sets, specifically, Birth Year and Trip Duration. As mentioned previously, the Birth Year category had unreasonable values that ranged from 1885-1920s, making the customers to be well over 100 years old. In the future to hinder this, the Birth Year should be validated. To continue, the Trip Duration variable had an excessive maximum value of 4319753 seconds (50 days) in one biking session. In analyzing the trip duration with a histogram, the outliers were calculated and removed which gave a different distribution. Using this data, Citibike can make an automatic setting where the bike turns off after an amount of time to prevent excessive trip duration values. Removing these influential points gives us better insights of the data. 

###9b. This question is not possible to answer with the two datasets provided: the ridership database and trip database. The question asks about finding the most number of unique riders on a specific day. The ridership database gives us how many types of passes that the customer buys and how many total trips were made on that day. This would not give us any insight of what customers specifically were making those rides. In the trip database, the data does show what kind of customers who were specifically making the rides, but gives no insight on what day they have made it on. Both databases give pieces to the puzzle, but there is no overlap that gives enough information to answer the question.  

###9c. There are 614 unique Citi Bike stations. The start station recorded only 606 stations whilst the end stations showed 614 stations. To pinpoint the exact amount of unique stations, the start and end station variables had to be combined to take account for each other’s unique stations. After combining the two variables, it was found that there were 614 unique stations and that the end stations had all unique stations recorded whilst the start station had only 606 out of the 614 unique stations. 
```{r}
length(table(citibike$Start.Station.Name))
length(unique(citibike$End.Station.Name))
length(table(c(citibike$Start.Station.ID,citibike$End.Station.ID)))
```

###9d. There were 10,082 unique Citi Bikes used at least once in the data.  

```{r, results='hide'}
length(unique(citibike$Bike.ID))
```

###9e. October 17, 2016 is the day with the most 3 day passes purchased. This was discovered by finding the maximum and locating other observations that had the same number as the  maximum. It ended up being only one day, which included the maximum. 
```{r}
max(citibikerides$X3.Day.Passes.Purchased.Today)
which.max(citibikerides$X3.Day.Passes.Purchased.Today)
which(citibikerides == 236, arr.ind = TRUE)
```

###9f. There were 34,619,850 cumulative trips made before the Citi Bike program started. 
```{r}
starttriptotal <- citibikerides$Cumulative.trips.since.launch[1] - citibikerides$Trips.today[1]
starttriptotal
```
